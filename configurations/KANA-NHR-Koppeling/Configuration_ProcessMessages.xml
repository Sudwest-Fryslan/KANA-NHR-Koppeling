<Module xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:noNamespaceSchemaLocation="../FrankConfig.xsd">
	<Adapter name="ProcessDDSMessageToKana">
		<Receiver>
			<ApiListener
				name="ProcessDDSMessageToKana"
				method="POST"
				uriPattern="/ProcessDDSMessageToKana/" />
		</Receiver>

		<Pipeline>
			<Exits>
				<Exit name="Success" state="SUCCESS" />
				<Exit name="Exception" state="ERROR" />
			</Exits>

			<!-- <XmlSwitchPipe name="CheckRequestElement"
			xpathExpression="local-name(//Body/*[1])">
				<Forward name="vesLv01" path="vesLv01_AddMissingElement" />
				<Forward name="vesLk01" path="" />
				<Forward name="macLv01" path="" />
				<Forward name="macLk01" path="" />
				<Forward name="nnpLv01" path="" />
				<Forward name="nnpLk01" path="" />
			</XmlSwitchPipe> -->

			<XsltPipe name="AddMissingElement" indentXml="true"
				styleSheetName="xsl/AddElement.xsl" omitXmlDeclaration="true" />

			<SenderPipe name="SendToKana">
				<WebServiceSender name="SendToKana" url="${kana_endpoint}"
					throwApplicationFaults="false" methodType="POST" contentType="text/xml"
					charSet="UTF-8"
					soap="false" />
				<Param name="soapAction"
					xpathExpression="concat('http://www.egem.nl/StUF/sector/bg/0310/', local-name(//Body/*[1])"
					sessionKey="originalMessage" />
			</SenderPipe>

			<XmlIfPipe name="FaultCheck" xpathExpression="not(//faultcode)">
				<Forward name="then" path="Success" />
				<Forward name="else" path="Exception" />
			</XmlIfPipe>
		</Pipeline>
	</Adapter>

</Module>